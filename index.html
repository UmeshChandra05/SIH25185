<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="refresh" content="2; url=https://studio-opal-pi.vercel.app/" />
  <title>Redirecting...</title>
</head>
<body>
  <h3>Redirecting to <a href="https://studio-opal-pi.vercel.app/"> DPR Insights Deployment</a>...</h3>
<script>
  (function() {
    const PSID = "SIH25185";
    const PSTitle = "North Eastern";

    const sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2,9);

    function getDeviceType() {
      const ua = navigator.userAgent;
      if (/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(ua)) return "Tablet";
      if (/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated/.test(ua)) return "Mobile";
      return "Desktop";
    }

    function getBrowser() {
      const ua = navigator.userAgent;
      if (ua.includes("Firefox")) return "Firefox";
      if (ua.includes("OPR") || ua.includes("Opera")) return "Opera";
      if (ua.includes("Trident")) return "IE";
      if (ua.includes("Edge")) return "Edge";
      if (ua.includes("Chrome")) return "Chrome";
      if (ua.includes("Safari")) return "Safari";
      return "Unknown";
    }

    function getOS() {
      const ua = navigator.userAgent;
      if (ua.includes("Win")) return "Windows";
      if (ua.includes("Mac")) return "MacOS";
      if (ua.includes("Linux")) return "Linux";
      if (ua.includes("Android")) return "Android";
      if (ua.includes("iPhone") || ua.includes("iPad")) return "iOS";
      return "Unknown";
    }

    const start = Date.now();

    const data = {
      sessionId: sessionId,
      PSID: PSID,
      PSTitle: PSTitle,
      ip: '',
      userAgent: navigator.userAgent,
      referrer: document.referrer || 'Direct',
      screenResolution: screen.width + 'x' + screen.height,
      language: navigator.language,
      timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
      deviceType: getDeviceType(),
      browser: getBrowser(),
      os: getOS(),
      sessionDuration: 0,
      pageUrl: window.location.href
    };

    function send() {
      data.sessionDuration = Math.round((Date.now() - start)/1000);
      fetch('https://umeshchandrapc.app.n8n.cloud/webhook/sih-visit', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      }).catch(console.error);
    }

    fetch('https://api.ipify.org?format=json')
      .then(res => res.json())
      .then(ipData => {
        data.ip = ipData.ip;
        send();
      })
      .catch(() => send());

    window.addEventListener('beforeunload', send);
  })();
</script>
</body>
</html>
